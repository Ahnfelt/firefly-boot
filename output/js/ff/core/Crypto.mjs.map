{
    "version": 3,
    "sources": [
        "../../../../../core/Crypto.ff"
    ],
    "sourcesContent": [
        "capability Crypto {}\n\nextend self: Crypto {\n    \n    randomUuid(): String {\n        self!->randomUUID()?\n    }\n    \n    randomBuffer(size: Int): Buffer {\n        let buffer = Buffer.new(size)\n        self.randomizeBuffer(buffer)\n        buffer\n    }\n\n    randomizeBuffer(buffer: Buffer): Unit {\n        self!->getRandomValues(Js->Uint8Array->(buffer!->buffer, buffer!->byteOffset, buffer!->byteLength))\n    }\n\n    hmacSha256(key: Buffer, buffer: Buffer): Buffer {\n        Js.throwIfCancelled()\n        let cryptoKey = Js.await(self!->subtle->importKey(\n            \"raw\"\n            key!\n            Js->(name = \"HMAC\", hash = Js->(name = \"SHA-256\"))\n            False\n            [\"sign\"]\n        ))\n        let signature = Js.await(self!->subtle->sign(\n            \"HMAC\"\n            cryptoKey\n            buffer!\n        )) \n        Js->DataView->(signature)?\n    }\n        \n    sha256(buffer: Buffer): Buffer {\n        Js.throwIfCancelled()\n        let hash = Js.await(self!->subtle->digest(\"SHA-256\", buffer))\n        Js->DataView->(hash)?\n    }\n\n    hashPassword(password: String, iterations: Int = 600000): String {\n        let salt = self.randomBuffer(16)\n        let hash = internalHashPassword(self, salt, password.toBuffer(), iterations)\n        \"$pbkdf2-sha256-hex$\" + iterations + \"$\" + salt.toHex() + \"$\" + hash.toHex()\n    }\n    \n    checkPassword(password: String, passwordHash: String): Bool {\n        passwordHash.split('$').{\n            | [\"\", \"pbkdf2-sha256-hex\", iterationsText, saltText, hashText] {\n                iterationsText.getInt() | Some(iterations)\n            } =>\n                let computedHash = \n                    internalHashPassword(self, Buffer.fromHex(saltText), password.toBuffer(), iterations)\n                let hash = Buffer.fromHex(hashText)\n                self.constantTimeEquals(computedHash, hash)\n            | _ => False\n        }\n    }\n\n    constantTimeEquals(buffer1: Buffer, buffer2: Buffer): Bool {\n        if(buffer1.size() != buffer2.size()) {False} else: \n        mutable v = 0\n        mutable i = 0\n        while {i < buffer1.size()} {\n            v = v.bitOr(buffer1.grabUint8(i).bitXor(buffer2.grabUint8(i)))\n            i += 1\n        }\n        v == 0\n    }\n\n}\n\ninternalHashPassword(system: Crypto, salt: Buffer, password: Buffer, iterations: Int): Buffer {\n    Js.throwIfCancelled()\n    let keyMaterial = Js.await(system!->subtle->importKey(\n        \"raw\"\n        password!\n        Js->(name = \"PBKDF2\")\n        False\n        [\"deriveBits\"]\n    ))\n    let hashBuffer = Js.await(system!->subtle->deriveBits(\n        Js->(\n            name = \"PBKDF2\"\n            salt = salt\n            iterations = iterations\n            hash = \"SHA-256\"\n        )\n        keyMaterial\n        256\n    ))\n    Js->DataView->(hashBuffer)?\n}\n"
    ],
    "names": [
        "internalHashPassword",
        "system",
        "salt",
        "password",
        "iterations",
        "keyMaterial",
        "subtle",
        "importKey",
        "name",
        "hashBuffer",
        "deriveBits",
        "hash",
        "\"DataView\"",
        "randomUuid",
        "self",
        "randomUUID",
        "randomBuffer",
        "size",
        "buffer",
        "new",
        "randomizeBuffer",
        "getRandomValues",
        "\"Uint8Array\"",
        "byteOffset",
        "byteLength",
        "hmacSha256",
        "key",
        "cryptoKey",
        "signature",
        "sign",
        "sha256",
        "digest",
        "hashPassword",
        "toBuffer",
        "toHex",
        "checkPassword",
        "passwordHash",
        "split",
        "iterationsText",
        "saltText",
        "hashText",
        "getInt",
        "Some",
        "computedHash",
        "fromHex",
        "constantTimeEquals",
        "buffer1",
        "buffer2",
        "v",
        "i",
        "bitOr",
        "bitXor",
        "grabUint8"
    ],
    "mappings": "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"
}